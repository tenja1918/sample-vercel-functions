<!DOCTYPE html>

<head>
  <title>Sample News App</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    #newsList {
      display:flex;
      flex-wrap:wrap;
      justify-content: space-around;
    }
    #newsList img {
      width: 200px;
      height: 150px;
    }
    .content {
      width: 200px;
      border: 1px solid #aaa;
    }
  </style>
  <script src="https://unpkg.com/vue@next"></script>
</head>

<body>
  <h2>Get News</h2>
  <div id="app" v-cloak>
    <input v-model="q" maxlength="256" placeholder="検索したい内容..." />
    <input class="btn btn-primary" type="button" value="ニュースを検索" @click="fetchNews" />
    <hr />
    <div id="newsList" v-if="articles.length > 0">
      <!--
      {{ result }}
      -->
      <div id="article" v-for="article in articles" :key="article.title">
        <a :href="article.url" target="_blank">
          <img v-if="article.urlToImage" :src="article.urlToImage" />
          <img v-else src="./images/no_image_logo.png" />
          <p>{{ article.title }}</p>
        </a>
      </div>
    </div>
    <div id="notfound" v-if="articles.length === 0">
      記事はありません。
    </div>
  </div>
</body>

<script>
  const app = Vue.createApp({
    data() {
      return {
        q: '',
        status: 0,
        // result: null,
        articles: [],
      }
    },
    methods: {
      async fetchNews() {
        const url = new URL("https://sample-vercel-functions.vercel.app/api/news/headlines");
        const queries = {
          q: this.q,
        };
        url.search = new URLSearchParams(queries).toString();

        fetch(url).then(res => {
          this.status = res.status;
          return res.json();
        }).then(json => {
          // const newsList = document.getElementById('newsList');
          // while (newsList.firstChild) {
          //   newsList.removeChild(newsList.firstChild);
          // }

          // if (json['totalResults'] == 0) {
          //   const div = document.createElement('div');
          //   div.innerHTML = '記事が見つかりませんでした';
          //   newsList.appendChild(div);
          // } else {
          //   json['articles'].forEach(item => {
          //     const div = document.createElement('div');
          //     div.classList.add('article');
          //     div.innerHTML = `<a href="${item.url}" target="_blank">
          //              <img src="${item.urlToImage}">
          //              <p>${item.title}</p>
          //              </a>`;
          //     newsList.appendChild(div);
          //   });
          // }
          this.articles = json['totalResults'] != 0 ? json['articles'] : [];
        });
      },
    },
  });
  app.mount('#app');
</script>

</html>
